# MadNCL.jl

[![Run tests](https://github.com/MadNLP/MadNCL.jl/actions/workflows/action.yml/badge.svg)](https://github.com/MadNLP/MadNCL.jl/actions/workflows/action.yml)

Implement the NCL algorithm within MadNLP.

# Benchmarks

To run benchmarks on a subset of problems:
```shell
julia --project=benchmarks/TAX/ benchmarks/TAX/main.jl
julia --project=benchmarks/COPS/ benchmarks/COPS/main.jl
julia --project=benchmarks/OPF/ benchmarks/OPF/main.jl
```

To run benchmarks for a specific problem, solver or tolerance, follows
the following instructions.

## Large-scale instances

### Optimal power flow (OPF) benchmark

```shell
julia --project=benchmarks/OPF/
```
```julia
path = joinpath("benchmarks", "OPF", "main.jl")
include(path)
main("pglib_opf_case78484_epigrids"; tol=1e-8)
```
### COPS benchmark

```shell
julia --project=benchmarks/COPS/
```
```julia
path = joinpath("benchmarks", "COPS", "main.jl")
include(path)
main("chain", madnlp=false, madncl=true, hykkt=false, likkt=false)
```

## Degenerate instances

### Tax benchmark
```shell
julia --project=benchmarks/TAX/
```
```julia
path = joinpath("benchmarks", "TAX", "main.jl")
include(path)
main(; tol=1e-6)
```

### Max loading benchmark

```shell
julia --project=benchmarks/OPF/
```
```julia
path = joinpath("benchmarks", "OPF", "maxopf.jl")
include(path)
main(; tol=1e-8)
```

## KKT benchmarks

If you just want to benchmarks the KKT systems:
```julia
path = joinpath("benchmarks", "OPF", "main.jl")
include(path)
main("pglib_opf_case78484_epigrids"; kkt_benchmark=true, max_iter=5)
```

# Content of the generated text files

The text file generated by a benchmark contains 8 columns and as many rows as there are instances benchmarked.
The meaning of each column is described as follows:
- `instance`: name of the instance;
- `status`: returned status of the solver, like MadNLP or MadNCL;
- `obj`: value of the objective once the solver stopped;
- `it`: number of iterations for the optimization solver;
- `total`: total elapsed time for the solver;
- `linsolve`: elapsed time dedicated to the linear solver;
- `AD`: elapsed time dedicated to computing derivatives;
- `tolerance`: tolerance used by the optimization solver.

The list of possible statuses is available [here](https://github.com/MadNLP/MadNLP.jl/blob/master/src/enums.jl#L21-L44).

# Graphics

## tables.jl

The file `benchmarks/tables.jl` reads the files in `benchmarks/results` to generate LaTeX tables in the folder `benchmarks/tex`.
```shell
julia benchmarks/tables.jl
```
Note that the packages `DelimitedFiles`, `DataFrames` and `SolverBenchmark` are required.

## plots.jl

The file `benchmarks/plots.jl` reads the files in `benchmarks/results` to generate graphics in the folders `benchmarks/svg` and `benchmarks/eps`.
```shell
julia benchmarks/plots.jl
```
Note that the packages `DelimitedFiles` and `PlotlyJS` are required.
